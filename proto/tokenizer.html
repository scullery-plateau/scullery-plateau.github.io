<html>
  <head>
    <title>Scullery Plateau: Tokenizer</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Caudex"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Modern+Antiqua"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/d550ee8263.js"
      crossorigin="anonymous"
    ></script>
    <link href="style/rpg.css" rel="stylesheet" />
    <link href="style/font.css" rel="stylesheet" />
    <link href="style/menu.css" rel="stylesheet" />
    <style type="text/css">
      .controls input[type='number'] {
        width: 5em;
      }
    </style>
    <script type="text/javascript" src="scripts/menues.js"></script>
    <!--<script type="text/javascript" src="scripts/popup.js"></script>-->
    <script type="text/javascript" src="scripts/test-image.js"></script>
    <script>
      window.initTokenizer = function () {
        let data = {
          id: 'bergrum.png',
          url: getTestImage(),
          baseScale: 100,
          xOffset: 0,
          yOffset: 0,
          scale: 1,
          sideCount: 2,
          frameColor: 'red',
          backgroundColor: 'white',
        };
        let getImageOrigin = function (offset) {
          let i = 1 - data.scale;
          i = i / 2;
          i = i * data.baseScale;
          return i + offset;
        };
        let getFrameRadius = function () {
          let i = data.baseScale / 2;
          return i - 1;
        };
        let drawShape = function (s) {
          let n = s.numberOfSides;
          if (n > 2 && n < 50) {
            let a = (Math.PI * 2) / n;
            let first = a / 2;
            let points = Array(n)
              .fill(0)
              .map((e, i) => {
                let ai = first + a * i;
                return [
                  s.cx + s.r * Math.sin(ai),
                  s.cy + s.r * Math.cos(ai),
                ].join(',');
              })
              .join(' ');
            return `
            <polygon points="${points}" fill="${s.bgColor}"/>
            <polygon points="${points}" fill="url(#myImage)" stroke="${s.frameColor}" stroke-width="1"/>`;
          } else {
            return `
            <circle cx="${s.cx}" cy="${s.cy}" r="${s.r}" fill="${s.bgColor}"/>
            <circle cx="${s.cx}" cy="${s.cy}" r="${s.r}" fill="url(#myImage)" stroke="${s.frameColor}" stroke-width="1"/>`;
          }
        };
        let drawCanvas = function () {
          console.log(data);
          let shape = drawShape({
            numberOfSides: data.sideCount,
            cx: data.baseScale / 2,
            cy: data.baseScale / 2,
            r: getFrameRadius(),
            bgColor: data.backgroundColor,
            frameColor: data.frameColor,
          });
          document.getElementById(
            'canvas'
          ).innerHTML = `<svg width="20em" height="20em" viewBox="0 0 ${
            data.baseScale
          } ${data.baseScale}">
            <defs>
              <!--
              <clipPath id="myFrame">
              </clipPath>
              -->
              <pattern id="myImage" x="0" y="0" width="100%" height="100%">
                <image x="0" y="0" width="${data.baseScale}" height="${
            data.baseScale
          }" href="${data.url}" transform="translate(${getImageOrigin(
            data.xOffset
          )},${getImageOrigin(data.yOffset)}) scale(${data.scale})"/>
              </pattern>
            </defs>
            ${shape}
          </svg>`;
        };
        window.setXOffset = function (input) {
          data.xOffset = parseInt(input.value);
          drawCanvas();
        };
        window.setYOffset = function (input) {
          data.yOffset = parseInt(input.value);
          drawCanvas();
        };
        window.setScale = function (input) {
          data.scale = parseFloat(input.value);
          drawCanvas();
        };
        window.setSideCount = function (input) {
          data.sideCount = parseInt(input.value);
          drawCanvas();
        };
        drawCanvas();
      };
    </script>
  </head>
  <body class="bg-dark text-light" onload="initTokenizer()">
    <div class="navbar justify-content-start">
      <div class="mr-3">
        <ul class="navbar-nav">
          <li class="rpg-box pl-3 pr-3 nav-item active drowpdown">
            <a
              href="#"
              class="text-light nav-link dropdown-toggle"
              onclick="toggleMenu(event,this)"
            ></a>
            <ul class="dropdown-menu rpg-box"></ul>
          </li>
        </ul>
      </div>
      <a href="index.html" class="navbar-brand text-light">Scullery Plateau:</a>
      <span class="navbar-brand">Tokenizer</span>
    </div>
    <div>
      <div class="rpg-box m-3 d-flex">
        <div class="d-flex flex-column w-25 controls">
          <div class="form-group">
            <label for="xOffset">X-Offset:</label>
            <input
              type="number"
              value="0"
              class="form-control"
              id="xOffset"
              onchange="setXOffset(this)"
            />
          </div>
          <div class="form-group">
            <label for="yOffset">Y-Offset:</label>
            <input
              type="number"
              value="0"
              class="form-control"
              id="yOffset"
              onchange="setYOffset(this)"
            />
          </div>
          <div class="form-group">
            <label for="scale">Scale:</label>
            <input
              type="number"
              min="0"
              value="1"
              step="0.01"
              class="form-control"
              id="scale"
              onchange="setScale(this)"
            />
          </div>
          <div class="form-group">
            <label for="sideCount">Side Count:</label>
            <input
              type="number"
              min="2"
              max="50"
              value="2"
              class="form-control"
              id="sideCount"
              onchange="setSideCount(this)"
            />
          </div>
          <button class="btn btn-light">Frame Color</button>
        </div>
        <div id="canvas"></div>
      </div>
    </div>
    <footer>
      <div class="jumbotronn text-center">
        <p>Built by Daniel Allen Johnson &#169; 2019 - 2022</p>
        <p>
          <a
            href="https://github.com/scullery-plateau/scullery-plateau.github.io"
            class="btn btn-outline-info"
            >See the code on GitHub.</a
          >
        </p>
      </div>
    </footer>
    <div style="display: none">
      <div id="about">
        <p>Outfitter coming soon!</p>
      </div>
    </div>
  </body>
</html>
